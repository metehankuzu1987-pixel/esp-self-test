<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tabirly | ESP Self‑Test</title>
  <meta name="description" content="Zener, Ganzfeld, Rüya, Önsezi ve Remote Viewing. RNG seed, grafikler, rozetler, profil ve paylaşılabilir rapor. Tek dosya, GitHub Pages uyumlu." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%2306b6d4'/%3E%3Cpath d='M14 32c8-12 28-12 36 0-8 12-28 12-36 0z' fill='%23fff'/%3E%3Ccircle cx='32' cy='32' r='6' fill='%237c3aed'/%3E%3C/svg%3E" />
  <meta name="robots" content="noindex, nofollow">
  <!-- OpenGraph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Tabirly | ESP Self-Test (Eğlence Amaçlı)">
  <meta property="og:description" content="Zener, Ganzfeld, Rüya, Önsezi ve Remote Viewing. RNG seed, grafikler, rozetler, paylaşılabilir rapor.">
  <meta property="og:url" content="https://metehankuzu1987-pixel.github.io/esp-self-test/">
  <meta property="og:image" content="https://metehankuzu1987-pixel.github.io/esp-self-test/og.png">
  <meta property="og:locale" content="tr_TR">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Tabirly | ESP Self-Test">
  <meta name="twitter:description" content="Zener • Mini-Ganzfeld • Rüya • Önsezi • Remote Viewing.">
  <meta name="twitter:image" content="https://metehankuzu1987-pixel.github.io/esp-self-test/og.png">
  <!-- PWA-ish basics -->
  <meta name="theme-color" content="#0b0e13">
  <!-- Schema.org (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Tabirly • ESP Self-Test",
    "url":"https://metehankuzu1987-pixel.github.io/esp-self-test/",
    "applicationCategory":"EntertainmentApplication",
    "operatingSystem":"Web",
    "description":"Zener, Ganzfeld, Rüya, Önsezi ve Remote Viewing için eğlencelik testler. Veriler tarayıcıda; JSON/CSV dışa aktar.",
    "inLanguage":["tr-TR","en-US"]
  }
  </script>
  <style>
/* =========================
   Tabirly ESP — Mobile-First Responsive CSS
   (drop-in replacement for your <style>)
   ========================= */
:root{
  --brand:#7c3aed; --brand2:#06b6d4;
  --bg:#0b0e13; --card:#11161f; --muted:#8aa0b3; --text:#e6eef5; --accent:var(--brand2); --accent2:var(--brand);
  --warn:#ffd166; --good:#7eed9a; --bad:#ff7a7a;

  --radius:16px; --pad:14px; --gap:12px; --shadow:0 10px 25px rgba(0,0,0,.35);

  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --sans: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;

  /* Fluid type & spacing */
  --step-1: clamp(12px, 0.74rem + 0.2vw, 13px);
  --step0:  clamp(14px, 0.88rem + 0.25vw, 16px);
  --step1:  clamp(16px, 1.02rem + 0.35vw, 18px);
  --step2:  clamp(18px, 1.18rem + 0.6vw, 22px);
  --step3:  clamp(22px, 1.4rem + 0.9vw, 28px);
  --pad-x: clamp(12px, 3vw, 18px);
  --pad-y: clamp(10px, 2.4vw, 14px);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:var(--sans);
  font-size:var(--step0);
  line-height:1.55;
  background:linear-gradient(180deg,#0b0e13,#0a0d12);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
a{color:var(--accent); text-decoration:none}
a:hover{color:#9ae6ff}

/* ---------- Header ---------- */
header{
  max-width:1200px;
  margin:clamp(12px,3.5vw,24px) auto clamp(6px,2vw,12px);
  padding:0 var(--pad-x);
}
.title{font-size:var(--step3); font-weight:800; letter-spacing:.2px}
.subtitle{color:var(--muted); margin-top:6px; font-size:var(--step0)}
.pill{background:rgba(255,255,255,.08); padding:3px 8px; border-radius:999px; font-size:var(--step-1); margin-left:6px}

/* ---------- Layout ---------- */
.shell{
  max-width:1200px; margin:0 auto clamp(50px,8vw,70px);
  padding:0 var(--pad-x);
  display:grid; gap:16px;
  grid-template-columns: 1fr;                 /* mobile first */
}
@media (min-width: 980px){
  .shell{ grid-template-columns: 300px 1fr; }
}

/* ---------- Side Nav ---------- */
.nav{
  position:sticky; top:10px;
  align-self:flex-start;
  background:rgba(255,255,255,.02);
  border:1px solid rgba(255,255,255,.06);
  border-radius:var(--radius);
  padding:10px;
  box-shadow:var(--shadow);
}
.nav h3{margin:6px 8px 8px; font-size:var(--step-1); color:var(--muted); text-transform:uppercase; letter-spacing:.8px}

/* Make nav actions wrap as chips on mobile */
.nav .row{display:flex; gap:8px; flex-wrap:wrap}
.nav button{
  width:100%;
  text-align:left;
  background:transparent;
  border:0; color:var(--text);
  padding:12px;
  border-radius:12px;
  cursor:pointer;
  display:flex; align-items:center; gap:10px;
  min-height:44px; /* touch target */
  font-size:var(--step0);
}
.nav button:hover{background:rgba(255,255,255,.04)}
.nav button.active{
  background:linear-gradient(90deg, rgba(107,211,255,.15), rgba(178,141,255,.1));
  outline:1px solid rgba(107,211,255,.25)
}

/* On wider screens, keep full-width buttons; on very small, 2 columns for module list */
@media (max-width:560px){
  #nav{display:grid; grid-template-columns:1fr 1fr; gap:8px}
  #nav button{width:100%}
}

/* ---------- Main Panel ---------- */
.panel{
  background:rgba(255,255,255,.02);
  border:1px solid rgba(255,255,255,.06);
  border-radius:var(--radius);
  padding: clamp(12px, 3.5vw, 18px);
  box-shadow:var(--shadow);
  overflow:hidden;
}
.row{display:flex; gap:var(--gap); flex-wrap:wrap}
.kv{display:flex; justify-content:space-between; align-items:center; gap:10px; padding:6px 0; min-height:36px}
.card{background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); padding:var(--pad)}
.muted{color:var(--muted)}
.inline-stat{display:flex; gap:10px; flex-wrap:wrap}
.chip{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08); padding:6px 10px; border-radius:10px; font-size:var(--step-1)}
.foot{margin-top:12px; color:var(--muted); font-size:var(--step-1)}
.danger{color:#ffb4b4}
.good{color:#9bf2b0}

.section-title{font-size:var(--step2); font-weight:800; margin:4px 0 10px}
.sub{font-size:var(--step-1); color:var(--muted)}
.list{list-style:disc; padding-left:20px; margin:6px 0}
.mono{font-family:var(--mono); font-size:calc(var(--step-1) * 0.95)}

/* ---------- Buttons & Inputs (mobile ergonomics) ---------- */
.btn{
  background:linear-gradient(90deg, var(--accent), var(--accent2));
  border:0; color:#001018; font-weight:700;
  padding:10px 14px; border-radius:12px; cursor:pointer;
  min-height:44px; font-size:var(--step0)
}
.btn.secondary{background:transparent; color:var(--text); border:1px solid rgba(255,255,255,.15)}
.btn.warn{background:var(--warn); color:#200}
.btn.ghost{background:transparent; color:var(--muted)}
.btn:disabled{opacity:.5; cursor:not-allowed}

input[type="number"], input[type="text"], textarea, select{
  width:100%;
  background:#0d131c; color:var(--text);
  border:1px solid rgba(255,255,255,.1);
  border-radius:10px; padding:10px;
  min-height:44px; font-size:16px; /* prevent iOS zoom */
}
textarea{min-height:110px; resize:vertical}

/* ---------- Settings grid ---------- */
.settings-grid{display:grid; grid-template-columns:1fr; gap:12px}
@media (min-width:700px){ .settings-grid{ grid-template-columns:1fr 1fr } }

/* ---------- Zener ---------- */
.zener-grid{
  display:grid;
  grid-template-columns: repeat(5, minmax(54px, 1fr)); /* mobile tighter */
  gap:10px;
}
@media (min-width:480px){
  .zener-grid{ grid-template-columns: repeat(5, minmax(68px, 1fr)); }
}
@media (min-width:768px){
  .zener-grid{ grid-template-columns: repeat(5, minmax(80px, 1fr)); }
}
.zbtn{
  aspect-ratio:1 / 1;
  display:flex; align-items:center; justify-content:center;
  border-radius:12px; background:#0d131c;
  border:1px solid rgba(255,255,255,.08);
  cursor:pointer; font-size:clamp(22px, 6vw, 30px);
  min-height:54px;
}
.zbtn:hover{background:#0f1825}
.zcard{font-size:1em}

/* ---------- Remote Viewing ---------- */
.rv-grid{
  display:grid; gap:10px;
  grid-template-columns: repeat(2, minmax(100px, 1fr)); /* mobile 2x2 */
}
@media (min-width:640px){
  .rv-grid{ grid-template-columns: repeat(4, minmax(120px, 1fr)); }
}
.rv-card{
  background:var(--card);
  border:1px dashed rgba(255,255,255,.15);
  border-radius:12px; padding:10px; min-height:110px;
  display:flex; align-items:center; justify-content:center
}
.rv-thumb{
  background:#0d131c; border:1px solid rgba(255,255,255,.08);
  border-radius:10px; padding:10px; width:100%
}

/* ---------- Tabs (About) ---------- */
.tabs{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 14px}
.tabs button{
  background:transparent; border:1px solid rgba(255,255,255,.15);
  color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer; min-height:40px
}
.tabs button:hover{background:rgba(255,255,255,.05)}

/* ---------- Tables: mobile scroll & compact ---------- */
.table-wrap{overflow:auto; -webkit-overflow-scrolling:touch}
table{width:100%; border-collapse:collapse; font-size:var(--step-1)}
th, td{ text-align:left; padding:8px 6px; border-bottom:1px solid rgba(255,255,255,.1); vertical-align:top; white-space:nowrap }
td .btn{padding:8px 10px; min-height:36px; font-size:var(--step-1)}
/* Convert any inline overflow:auto wrappers to behave nicely on iOS */
div[style*="overflow:auto"]{ -webkit-overflow-scrolling:touch }

/* ---------- Media Queries: small phones polishing ---------- */
@media (max-width:400px){
  .title{font-size: clamp(20px, 8vw, 24px)}
  .subtitle{font-size: var(--step-1)}
  .nav{padding:8px}
  .btn{padding:10px 12px}
  .kv{gap:8px}
}

/* ---------- Safe area (iOS notch) ---------- */
@supports (padding: max(0px)){
  header{ padding-left: max(var(--pad-x), env(safe-area-inset-left)); padding-right: max(var(--pad-x), env(safe-area-inset-right)); }
  .shell{  padding-left: max(var(--pad-x), env(safe-area-inset-left)); padding-right: max(var(--pad-x), env(safe-area-inset-right)); }
  .nav{    top: calc(env(safe-area-inset-top) + 10px); }
}

/* ---------- Reduced motion ---------- */
@media (prefers-reduced-motion: reduce){
  *{animation-duration:0.01ms !important; animation-iteration-count:1 !important; transition-duration:0.01ms !important; scroll-behavior:auto !important}
}
    @media (max-width: 980px){
  .nav{
    position: static !important;  /* sticky devre dışı */
    top: auto !important;
    z-index: auto;
  }
}
  </style>
</head>
<body>
  <header>
    <div class="title">Tabirly • ESP Self‑Test</div>
    <div class="subtitle" id="subtitle">Zener • Mini‑Ganzfeld • Rüya • Önsezi • <b>Remote Viewing</b>. Tüm veriler cihazında saklanır; JSON/CSV indirilebilir.Önsezi, Duygu Dışı Algınızı test edebilirsiniz.</div>
  </header>

  <main class="shell">
    <aside class="nav" aria-label="Modüller">
      <h3 id="nav_title">Modüller</h3>
      <div class="row" style="padding:6px 6px 10px">
        <button class="btn secondary" id="langBtn" onclick="toggleLang()">TR/EN</button>
        <button class="btn secondary" onclick="go('settings')">Ayarlar</button>
      </div>
      <div id="nav"></div>
      <h3 style="margin-top:14px" id="data_title">Veri</h3>
      <div class="row" style="padding:6px">
        <button id="btn_json" class="btn secondary" onclick="exportJSON()">JSON İndir</button>
        <button id="btn_csv" class="btn secondary" onclick="exportCSV()">CSV İndir</button>
        <button id="btn_png" class="btn secondary" onclick="shareImage()">Rapor PNG</button>
        <label id="lbl_json" class="btn ghost" style="cursor:pointer">
          JSON Yükle<input type="file" accept="application/json" hidden onchange="importJSON(event)" />
        </label>
        <button id="btn_clear" class="btn warn" onclick="if(confirm(t('clear_confirm'))){store.clear(); location.reload()} ">Tüm Veriyi Sil</button>
      </div>
      <p class="foot" id="privacy_note">Gizlilik: Veriler yalnızca tarayıcında saklanır. Sunucuya gönderilmez.</p>
    </aside>

    <section id="view" class="panel" aria-live="polite"></section>
  </main>

<script>
// ================= I18N =================
const I18N = {
  tr: {
    modules:'Modüller', data:'Veri', privacy:'Gizlilik: Veriler yalnızca tarayıcında saklanır. Sunucuya gönderilmez.',
    clear_confirm:'Tüm yerel veriler silinsin mi?',
    dashboard:'Ana Panel', zener:'Zener Kart Testi', ganzfeld:'Mini‑Ganzfeld', dreams:'Rüya Testi', premonitions:'Önsezi Günlüğü', remote:'Remote Viewing', about:'Hakkında / Uyarı', settings:'Ayarlar',
    rng_seed:'RNG Tohumu (Seed)', rng_note:'Şeffaflık için tüm rastgelelik bu tohumla üretilir.',
    randomize:'Rastgeleleştir', set_seed:'Tohum Belirle', theme:'Tema', brand_primary:'Birincil Renk', brand_secondary:'İkincil Renk',
    save:'Kaydet',
    onboarding:'Mini Rehber',
    step1:'Zener’de 25 tur yap. Seri halinde oturumlarla bak.',
    step2:'Ganzfeld’de izlenimleri önce yaz, sonra seçim yap.',
    step3:'Rüyayı uyanınca 30 sn içinde not et; akşam eşleşmeyi işaretle.',
    step4:'Önsezi notlarını tek cümle yaz; sonra Oldu/Olmadı.',
    seed_display:'Aktif Seed',
    profile:'Profil', name:'Ad/Rumuz', badges:'Rozetler',

    // static buttons/labels
    json_dl:'JSON İndir', csv_dl:'CSV İndir', png_report:'Rapor PNG', json_ul:'JSON Yükle', delete_all:'Tüm Veriyi Sil',
    new_session:'Yeni Seans', save_session:'Seansı Kaydet', no_records:'Henüz kayıt yok.', history:'Geçmiş',
    result:'Sonuç', target:'Hedef', choice:'Seçim', impressions:'İzlenimler',
    matched:'Eşleşti', not_matched:'Eşleşmedi', status:'Durum', action:'Eylem', summary:'Özet', date:'Tarih', time:'Zaman', note:'Not',
    happened:'Oldu', not_happened:'Olmadı',
    profile_updated:'Profil güncellendi', theme_updated:'Tema güncellendi', seed_updated:'Seed güncellendi', confirm_reset:'Oturum sıfırlansın mı?',
    hits:'İsabet', percent_col:'Yüzde', binom_tail:'Binom Kuyruk', charts:'Mini Grafikler'
  },
  en: {
    modules:'Modules', data:'Data', privacy:'Privacy: Data stays in your browser. Nothing is uploaded.',
    clear_confirm:'Delete all local data?',
    dashboard:'Dashboard', zener:'Zener Card Test', ganzfeld:'Mini‑Ganzfeld', dreams:'Dream Test', premonitions:'Premonition Log', remote:'Remote Viewing', about:'About / Notice', settings:'Settings',
    rng_seed:'RNG Seed', rng_note:'All randomness comes from this seed for transparency.',
    randomize:'Randomize', set_seed:'Set Seed', theme:'Theme', brand_primary:'Primary Color', brand_secondary:'Secondary Color',
    save:'Save',
    onboarding:'Quick Guide',
    step1:'Run 25 Zener trials. Prefer series over single session.',
    step2:'In Ganzfeld, write impressions first; choose later.',
    step3:'Write dream notes within 30s; mark match in the evening.',
    step4:'Log hunches in one line; later mark happened/didn’t.',
    seed_display:'Active Seed',
    profile:'Profile', name:'Name/Nickname', badges:'Badges',

    json_dl:'Download JSON', csv_dl:'Download CSV', png_report:'Report PNG', json_ul:'Load JSON', delete_all:'Delete All',
    new_session:'New Session', save_session:'Save Session', no_records:'No records yet.', history:'History',
    result:'Result', target:'Target', choice:'Choice', impressions:'Impressions',
    matched:'Matched', not_matched:'Not Matched', status:'Status', action:'Action', summary:'Summary', date:'Date', time:'Time', note:'Note',
    happened:'Happened', not_happened:'Didn’t',
    profile_updated:'Profile updated', theme_updated:'Theme updated', seed_updated:'Seed updated', confirm_reset:'Reset the session?',
    hits:'Hits', percent_col:'Percent', binom_tail:'Binomial Tail', charts:'Mini Charts'
  }
};
let LANG = localStorage.getItem('tbx-esp-lang') || 'tr';
function t(k){ return (I18N[LANG]&&I18N[LANG][k]) || (I18N['tr'][k]) || k }
function toggleLang(){
  LANG = (LANG==='tr'?'en':'tr');
  localStorage.setItem('tbx-esp-lang', LANG);
  renderNav(); applyI18nStatic();
  go(currentView||'dashboard');
}
function applyI18nStatic(){
  const byId=(id,txt)=>{ const el=document.getElementById(id); if(!el) return; if(el.tagName==='LABEL'){ el.childNodes[0].nodeValue = txt; } else { el.textContent = txt; } };
  document.getElementById('nav_title').textContent=t('modules');
  document.getElementById('data_title').textContent=t('data');
  document.getElementById('privacy_note').textContent=t('privacy');
  byId('btn_json', t('json_dl'));
  byId('btn_csv', t('csv_dl'));
  byId('btn_png', t('png_report'));
  byId('lbl_json', t('json_ul'));
  byId('btn_clear', t('delete_all'));
}

// ========== Minimal Store ==========
const NS = 'tbx-esp-';
const store = {
  get: (k, d=null) => { try { const v = localStorage.getItem(NS+k); return v? JSON.parse(v): d } catch(e){ console.warn(e); return d } },
  set: (k, v) => localStorage.setItem(NS+k, JSON.stringify(v)),
  del: (k) => localStorage.removeItem(NS+k),
  clear: () => Object.keys(localStorage).filter(k=>k.startsWith(NS)).forEach(k=>localStorage.removeItem(k))
};

// ========== Seeded RNG ==========
function mulberry32(a){ return function(){ let t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296 } }
function setSeed(v){ const n = Number(v)>>>0; store.set('rng-seed', n); RNG = mulberry32(n); alert(t('seed_updated')); }
let RNG = null; (function initSeed(){ let seed = store.get('rng-seed', null); if(seed===null){ seed = (Date.now() & 0xffffffff)>>>0; store.set('rng-seed', seed) } RNG = mulberry32(seed) })();
function srand(){ return RNG() }
function spick(arr){ return arr[Math.floor(srand()*arr.length)] }

// ========== Router / Views ==========
let currentView = null;
const views = { dashboard, zener, ganzfeld, dreams, premonitions, remote, about, settings };
let navItems = [];
function buildNavItems(){
  navItems = [
    ['dashboard', t('dashboard')],
    ['zener', t('zener')],
    ['ganzfeld', t('ganzfeld')],
    ['remote', t('remote')],
    ['dreams', t('dreams')],
    ['premonitions', t('premonitions')],
    ['about', t('about')],
    ['settings', t('settings')]
  ];
}
function renderNav(){
  buildNavItems();
  const el = document.getElementById('nav');
  el.innerHTML = '';
  navItems.forEach(([id,label])=>{
    const b = document.createElement('button'); b.textContent = label; b.onclick = ()=>go(id); b.id = 'nav-'+id; el.appendChild(b);
  });
}
function go(id){
  currentView = id;
  const view = document.getElementById('view');
  Array.from(document.querySelectorAll('.nav button')).forEach(b=>b.classList.remove('active'));
  const nb = document.getElementById('nav-'+id); if(nb) nb.classList.add('active');
  view.innerHTML = views[id] ? views[id]() : '<p>Bulunamadı</p>';
  if(id === 'about') { aboutTab('intro'); }   // <<< ek satır
}

// ========== Helpers ==========
function fmtDate(ts){ const d=new Date(ts); return d.toLocaleString(LANG==='tr'?'tr-TR':'en-US') }
function uid(){ return Math.random().toString(36).slice(2) }
function download(filename, text){ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([text],{type:'text/plain'})); a.download=filename; a.click(); URL.revokeObjectURL(a.href) }
function percent(x){ return (x*100).toFixed(1)+'%' }
function sparkbar(values){ const w=160,h=32,max=Math.max(1,...values); const step=w/values.length; let rects=''; values.forEach((v,i)=>{ const bh = Math.max(1, h*(v/max)); const x=i*step+2, y=h-bh; rects += `<rect x="${x}" y="${y}" width="${Math.max(1,step-4)}" height="${bh}" rx="2" fill="url(#g)"/>` }); return `
<svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="var(--accent)"/><stop offset="100%" stop-color="var(--accent2)"/></linearGradient></defs>${rects}</svg>` }

// ========== Profile & Badges ==========
function getProfile(){ return store.get('profile', { name:'', badges:[] }) }
function setProfile(p){ store.set('profile', p) }
function awardBadges(){
  const p = getProfile();
  const z = store.get('zener-sessions', []).length;
  const g = store.get('ganzfeld-sessions', []).length;
  const d = store.get('dream-entries', []).length;
  const rv = store.get('rv-sessions', []).length;
  function add(b){ if(!p.badges.includes(b)) p.badges.push(b) }
  if(z>=5) add('Zener Novice');
  if(z>=25) add('Zener Pro');
  if(g>=5) add('Ganz Explorer');
  if(d>=7) add('Dreamer');
  if(rv>=5) add('Remote Scout');
  setProfile(p);
}

// ========== Dashboard ==========
function dashboard(){
  const z = store.get('zener-sessions', []);
  const g = store.get('ganzfeld-sessions', []);
  const d = store.get('dream-entries', []);
  const p = store.get('premonitions', []);
  const rv = store.get('rv-sessions', []);
  const prof = getProfile();
  const zHits = z.reduce((a,s)=>a+s.hits,0), zN = z.reduce((a,s)=>a+s.n,0);
  const gHits = g.reduce((a,s)=>a+s.correct,0), gN = g.reduce((a,s)=>a+s.n,0);
  const dMatch = d.filter(x=>x.matched===true).length;
  const pHit = p.filter(x=>x.confirmed===true).length;
  const rvHits = rv.filter(x=>x.correct===1).length;
  const zSeries = z.slice(-12).map(s=> Number((s.hits/s.n*100).toFixed(1)) );
  const gSeries = g.slice(-12).map(s=> s.correct?100:0 );
  const seed = store.get('rng-seed');
  return `
  <div class="row">
    <div class="card" style="flex:1; min-width:280px">
      <div class="section-title">${t('dashboard')}</div>
      <div class="kv"><div>${t('profile')}</div><div><input id="pfname" type="text" placeholder="${t('name')}" value="${prof.name}" onblur="saveName(this.value)" /></div></div>
      <div class="kv"><div>${t('zener')}</div><div><b>${zHits}/${zN}</b> <span class="muted">(${zN?percent(zHits/zN):'–'})</span></div></div>
      <div class="kv"><div>${t('ganzfeld')}</div><div><b>${gHits}/${gN}</b> <span class="muted">(${gN?percent(gHits/gN):'–'})</span></div></div>
      <div class="kv"><div>${t('remote')}</div><div><b>${rvHits}/${rv.length}</b></div></div>
      <div class="kv"><div>${t('dreams')}</div><div><b>${dMatch}/${d.length}</b></div></div>
      <div class="kv"><div>${t('premonitions')}</div><div><b>${pHit}/${p.length}</b></div></div>
      <div class="kv"><div>${t('seed_display')}</div><div class="mono">${seed}</div></div>
      <div class="kv"><div>${t('badges')}</div><div>${getProfile().badges.map(b=>`<span class='chip'>${b}</span>`).join(' ')||'<span class="muted">—</span>'}</div></div>
      <div class="foot">${t('privacy')}</div>
    </div>
    <div class="card" style="flex:1; min-width:280px">
      <div class="section-title">${t('charts')}</div>
      <div class="kv"><div>Zener %</div><div>${zSeries.length? sparkbar(zSeries): '<span class="muted">—</span>'}</div></div>
      <div class="kv"><div>Ganzfeld</div><div>${gSeries.length? sparkbar(gSeries): '<span class="muted">—</span>'}</div></div>
      <div class="section-title" style="margin-top:10px">${t('onboarding')}</div>
      <ul class="list">
        <li>${t('step1')}</li>
        <li>${t('step2')}</li>
        <li>${t('step3')}</li>
        <li>${t('step4')}</li>
      </ul>
      <div class="row" style="margin-top:10px">
        <button class="btn secondary" onclick="shareImage()">${t('png_report')}</button>
        <button class="btn" onclick="go('remote')">${t('remote')}</button>
      </div>
    </div>
  </div>`
}
function saveName(v){ const p=getProfile(); p.name=v.trim(); setProfile(p); alert(t('profile_updated')); }

// ========== Zener ==========
const ZENER = [
  {k:'star', label:'Yıldız ⭐', icon:'⭐'},
  {k:'circle', label:'Daire ⚫', icon:'⚫'},
  {k:'plus', label:'Artı ➕', icon:'➕'},
  {k:'square', label:'Kare ◼', icon:'◼'},
  {k:'waves', label:'Dalga 🌊', icon:'🌊'}
];
function zener(){
  let s = store.get('zener-state', null);
  if(!s){
    const deck = [...Array(25)].map((_,i)=> Math.floor(i/5));
    for(let i=deck.length-1; i>0; i--){ const j=Math.floor(srand()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]] }
    s = { id: uid(), ts: Date.now(), step:0, deck, guesses:[], hits:0 };
    store.set('zener-state', s);
  }
  const done = s.step>=s.deck.length; const n = s.deck.length;
  return `
  <div class="section-title">${t('zener')} <span class="sub">(25)</span></div>
  <div class="inline-stat">
    <span class="chip">${t('hits')}: <b>${s.hits}</b></span>
    <span class="chip">${t('percent_col')}: <b>${percent(s.hits/(s.step||1))}</b></span>
  </div>
  <div style="margin-top:12px" class="muted">RNG seed=<span class="mono">${store.get('rng-seed')}</span>.</div>
  ${done? `<div class="good" style="margin:10px 0">${t('result')}: ${s.hits}/${n}</div>`: ''}
  <div class="zener-grid" style="margin-top:12px">${ZENER.map((z,i)=> `<button class="zbtn" onclick="zenerGuess(${i})" ${done?'disabled':''} title="${z.label}"><span class="zcard">${z.icon}</span></button>`).join('')}</div>
  <div class="row" style="margin-top:14px"><button class="btn secondary" onclick="zenerReset(true)">${t('new_session')}</button><button class="btn" onclick="zenerFinish()">${t('save_session')}</button></div>
  ${renderZenerHistory()}`
}
function zenerGuess(i){ const s = store.get('zener-state'); if(s.step>=s.deck.length) return; const target = s.deck[s.step]; s.guesses.push(i); if(i===target) s.hits++; s.step++; store.set('zener-state', s); go('zener'); }
function zenerFinish(){ const s = store.get('zener-state'); if(!s) return; const n = s.deck.length; const arr = store.get('zener-sessions', []); arr.push({ id:s.id, ts:s.ts, n, hits:s.hits, guesses:s.guesses, deck:s.deck }); store.set('zener-sessions', arr); store.del('zener-state'); awardBadges(); alert(`${t('save_session')}: ${s.hits}/${n}`); go('zener'); }
function zenerReset(confirmAsk){ if(confirmAsk && !confirm(t('confirm_reset'))) return; store.del('zener-state'); go('zener') }
function renderZenerHistory(){ const arr = store.get('zener-sessions', []); if(arr.length===0) return `<div class="card" style="margin-top:16px"><div class="muted">${t('no_records')}</div></div>`; function binomTailGE(n,k,p){ function logFact(m){ let s=0; for(let i=2;i<=m;i++) s+=Math.log(i); return s } function logChoose(n,r){ return logFact(n)-logFact(r)-logFact(n-r) } function logBinom(n,r,p){ return logChoose(n,r)+ r*Math.log(p) + (n-r)*Math.log(1-p) } let sum=0; for(let r=k;r<=n;r++){ sum+= Math.exp( logBinom(n,r,p) ) } return sum } const rows = arr.slice().reverse().map(s=>{ const p = (s.hits/s.n); const tail = binomTailGE(s.n, s.hits, 0.2); return `<tr><td class="mono">${fmtDate(s.ts)}</td><td>${s.hits}/${s.n}</td><td>${(p*100).toFixed(1)}%</td><td title="P(X≥k) for p=0.20" class="mono">${tail.toExponential(2)}</td></tr>` }).join(''); const series = arr.map(s=> Number((s.hits/s.n*100).toFixed(1)) ); return `<div class="card" style="margin-top:16px"><div class="section-title">${t('history')}</div><div style="margin:6px 0">${series.length? sparkbar(series.slice(-16)) : ''}</div><div style="overflow:auto"><table style="width:100%; border-collapse:collapse"><thead><tr><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('date')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('hits')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('percent_col')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('binom_tail')}</th></tr></thead><tbody>${rows}</tbody></table></div></div>` }

// ========== Mini-Ganzfeld ==========
const GF_POOL = [ 'Kırmızı kapı', 'Fok balığı', 'Savaş uçağı', 'Ayçiçeği tarlası', 'Palyaço balığı', 'Karlı dağ', 'Gitar', 'Şimşek' ];
function ganzfeld(){ let s = store.get('ganz-state', null); if(!s){ const pool = []; const src = GF_POOL.slice(); while(pool.length < 4){ const x = spick(src); if(!pool.includes(x)) pool.push(x) } s = { id:uid(), phase:'impress', pool, target:Math.floor(srand()*4), impressions:'', ts:Date.now() }; store.set('ganz-state', s) } if(s.phase==='impress'){ return `<div class="section-title">${t('ganzfeld')}</div><div class="sub">${LANG==='tr'?'Aşağıdaki 4 hedeften biri gizlice seçildi. 2–5 dakika aklına gelenleri yaz, sonra seçim yap.':'One of the 4 targets is hidden. Write impressions for 2–5 minutes, then choose.'}</div><div class="card" style="margin-top:10px"><b>${LANG==='tr'?'Hedef Havuzu (4)':'Target Pool (4)'}</b><ul class="list">${s.pool.map(x=>`<li>${x}</li>`).join('')}</ul></div><label class="muted" style="display:block; margin:10px 0 6px">${t('impressions')}</label><textarea oninput="(function(v){ const s=store.get('ganz-state'); s.impressions=v; store.set('ganz-state',s) })(this.value)">${s.impressions||''}</textarea><div class="row" style="margin-top:10px"><button class="btn" onclick="(function(){ const s=store.get('ganz-state'); s.phase='choose'; store.set('ganz-state',s); go('ganzfeld') })()">${t('choose')}</button><button class="btn secondary" onclick="ganzReset(true)">${t('reset_session')}</button></div>` } if(s.phase==='choose'){ return `<div class="section-title">${t('choice')}</div><div class="sub">${LANG==='tr'?'Hangi hedefe en çok benziyor?':'Which target matches best?'}</div><div class="row" style="margin-top:10px">${s.pool.map((x,i)=>`<button class="btn secondary" onclick="ganzChoose(${i})">${i+1}. ${x}</button>`).join('')}</div><div class="foot">RNG seed: <span class="mono">${store.get('rng-seed')}</span></div>` } if(s.phase==='done'){ const ok = s.choice===s.target; const entry = `<div class="card" style="margin-top:10px"><div class="inline-stat"><span class="chip">${t('choice')}: <b>${s.pool[s.choice]}</b></span><span class="chip">${t('target')}: <b>${s.pool[s.target]}</b></span><span class="chip">${t('status')}: <b>${ok? (LANG==='tr'?'Doğru':'Correct'):(LANG==='tr'?'Yanlış':'Wrong')}</b></span></div><div style="margin-top:8px"><b>${t('impressions')}:</b><div class="muted">${(s.impressions||'—').replace(/[<>]/g,'')}</div></div></div>`; return `<div class="section-title">${t('result')}</div>${entry}<div class="row" style="margin-top:12px"><button class="btn" onclick="ganzSave()">${t('save')}</button><button class="btn secondary" onclick="ganzReset()">${t('new_session')}</button></div>${renderGanzHistory()}` } }
function ganzChoose(i){ const s=store.get('ganz-state'); s.choice=i; s.phase='done'; store.set('ganz-state',s); go('ganzfeld') }
function ganzSave(){ const s=store.get('ganz-state'); if(!s||s.phase!=='done') return; const arr=store.get('ganzfeld-sessions', []); const entry={id:s.id, ts:s.ts, pool:s.pool, target:s.target, choice:s.choice, impressions:s.impressions, correct: s.choice===s.target?1:0, n:1}; arr.push(entry); store.set('ganzfeld-sessions', arr); store.del('ganz-state'); awardBadges(); alert(LANG==='tr'?'Kaydedildi.':'Saved.'); go('ganzfeld') }
function ganzReset(confirmAsk){ if(confirmAsk && !confirm(t('confirm_reset'))) return; store.del('ganz-state'); go('ganzfeld') }
function renderGanzHistory(){ const arr = store.get('ganzfeld-sessions', []); if(arr.length===0) return `<div class="card" style="margin-top:16px"><div class="muted">${t('no_records')}</div></div>`; const rows = arr.slice().reverse().map(s=> `<tr><td class="mono">${fmtDate(s.ts)}</td><td>${s.correct? (LANG==='tr'?'Doğru':'Correct'):(LANG==='tr'?'Yanlış':'Wrong')}</td><td>${s.pool[s.target]}</td><td>${s.pool[s.choice]}</td><td class="muted">${(s.impressions||'').slice(0,80)}${(s.impressions||'').length>80?'…':''}</td></tr>`).join(''); const ok = arr.reduce((a,x)=>a+x.correct,0); const series = arr.map(s=> s.correct?100:0 ); return `<div class="card" style="margin-top:16px"><div class="section-title">${t('history')}</div><div style="margin:6px 0">${series.length? sparkbar(series.slice(-16)) : ''}</div><div class="kv"><div>${t('summary')}</div><div><b>${ok}/${arr.length}</b> <span class="muted">(${percent(ok/arr.length)})</span></div></div><div style="overflow:auto"><table style="width:100%; border-collapse:collapse; margin-top:8px"><thead><tr><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('date')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('result')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('target')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('choice')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('impressions')}</th></tr></thead><tbody>${rows}</tbody></table></div></div>` }

// ========== Dreams ==========
function dreams(){ const entries = store.get('dream-entries', []); return `<div class="section-title">${t('dreams')}</div><div class="sub">${LANG==='tr'?'Kişisel hedef belirle → uyumadan önce niyet → sabah rüyayı yaz → gün sonunda eşleşme işaretle.':'Pick a theme → set intention → write dream on waking → mark match at night.'}</div><div class="card" style="margin-top:10px"><div class="row settings-grid"><div><label>${LANG==='tr'?'Hedef / Tema':'Goal / Theme'}</label><input id="dr-goal" type="text" placeholder="${LANG==='tr'?'ör. kırmızı kapı':'e.g. red door'}" /></div><div><label>${LANG==='tr'?'Gün':'Day'}</label><input id="dr-date" type="date" /></div></div><label style="margin-top:8px; display:block">${LANG==='tr'?'Rüya Notu':'Dream Note'}</label><textarea id="dr-note" placeholder="${LANG==='tr'?'uyanır uyanmaz kısa not…':'short note on waking…'}"></textarea><div class="row" style="margin-top:10px"><button class="btn" onclick="dreamAdd()">${t('save')}</button><button class="btn secondary" onclick="dreamClearForm()">${LANG==='tr'?'Temizle':'Clear'}</button></div></div>${renderDreamList(entries)}` }
function dreamAdd(){ const goal = document.getElementById('dr-goal').value.trim(); const date = document.getElementById('dr-date').value || new Date().toISOString().slice(0,10); const note = document.getElementById('dr-note').value.trim(); if(!goal){ alert(LANG==='tr'?'Hedef/tema yaz.':'Enter a goal/theme.'); return } const arr = store.get('dream-entries', []); arr.push({ id:uid(), date, ts:Date.now(), goal, note, matched:null }); store.set('dream-entries', arr); dreamClearForm(); go('dreams'); }
function dreamClearForm(){ ['dr-goal','dr-date','dr-note'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value='' }) }
function dreamMatch(id, val){ const arr=store.get('dream-entries', []); const i=arr.findIndex(x=>x.id===id); if(i>=0){ arr[i].matched=val; store.set('dream-entries', arr); go('dreams') } }
function dreamDel(id){ const arr=store.get('dream-entries', []).filter(x=>x.id!==id); store.set('dream-entries', arr); go('dreams') }
function renderDreamList(entries){ if(entries.length===0) return `<div class="card" style="margin-top:14px"><div class="muted">${t('no_records')}</div></div>`; const ok = entries.filter(x=>x.matched===true).length, no = entries.filter(x=>x.matched===false).length; const rows = entries.slice().reverse().map(x=>`<tr><td class="mono">${x.date}</td><td>${x.goal}</td><td class="muted">${x.note.slice(0,60)}${x.note.length>60?'…':''}</td><td>${x.matched===true? '<span class="good">'+t('matched')+'</span>': x.matched===false? '<span class="danger">'+t('not_matched')+'</span>': '<span class="muted">—</span>'}</td><td><button class="btn secondary" onclick="dreamMatch('${x.id}', true)">${t('matched')}</button><button class="btn secondary" onclick="dreamMatch('${x.id}', false)">${t('not_matched')}</button><button class="btn secondary" onclick="dreamDel('${x.id}')">${LANG==='tr'?'Sil':'Delete'}</button></td></tr>`).join(''); return `<div class="card" style="margin-top:14px"><div class="kv"><div>${t('summary')}</div><div><b>${ok}</b> ${t('matched').toLowerCase()}, <b>${no}</b> ${t('not_matched').toLowerCase()}, <b>${entries.length}</b> total</div></div><div style="overflow:auto; margin-top:8px"><table style="width:100%; border-collapse:collapse"><thead><tr><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('date')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${LANG==='tr'?'Hedef':'Goal'}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${LANG==='tr'?'Rüya Notu':'Dream Note'}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('status')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('action')}</th></tr></thead><tbody>${rows}</tbody></table></div></div>` }

// ========== Premonitions ==========
function premonitions(){ const items = store.get('premonitions', []); return `<div class="section-title">${t('premonitions')}</div><div class="sub">${LANG==='tr'?'Ani his geldiğinde kısa not bırak; sonra Oldu/Olmadı.':'Write a quick hunch; later mark Happened/Didn’t.'}</div><div class="card" style="margin-top:10px"><label>${LANG==='tr'?'Not (tek cümle)':'Note (one line)'}</label><input id="pr-note" type="text" placeholder="${LANG==='tr'?'Örn: Bugün ablam arayacak':'e.g. My sister will call me today'}" /><div class="row" style="margin-top:8px"><button class="btn" onclick="premAdd()">${LANG==='tr'?'Ekle':'Add'}</button><button class="btn secondary" onclick="document.getElementById('pr-note').value=''">${LANG==='tr'?'Temizle':'Clear'}</button></div></div>${renderPremList(items)}` }
function premAdd(){ const v=document.getElementById('pr-note').value.trim(); if(!v) return alert(LANG==='tr'?'Bir not yaz.':'Write a note.'); const arr=store.get('premonitions', []); arr.push({ id:uid(), ts:Date.now(), note:v, confirmed:null }); store.set('premonitions', arr); document.getElementById('pr-note').value=''; go('premonitions') }
function premSet(id, val){ const arr=store.get('premonitions', []); const i=arr.findIndex(x=>x.id===id); if(i>=0){ arr[i].confirmed=val; store.set('premonitions', arr); go('premonitions') } }
function premDel(id){ const arr=store.get('premonitions', []).filter(x=>x.id!==id); store.set('premonitions', arr); go('premonitions') }
function renderPremList(items){ if(items.length===0) return `<div class="card" style="margin-top:14px"><div class="muted">${t('no_records')}</div></div>`; const yes = items.filter(x=>x.confirmed===true).length, no = items.filter(x=>x.confirmed===false).length; const rows = items.slice().reverse().map(x=>`<tr><td class="mono">${fmtDate(x.ts)}</td><td>${x.note}</td><td>${x.confirmed===true? '<span class="good">'+t('happened')+'</span>': x.confirmed===false? '<span class="danger">'+t('not_happened')+'</span>': '<span class="muted">—</span>'}</td><td><button class="btn secondary" onclick="premSet('${x.id}', true)">${t('happened')}</button><button class="btn secondary" onclick="premSet('${x.id}', false)">${t('not_happened')}</button><button class="btn secondary" onclick="premDel('${x.id}')">${LANG==='tr'?'Sil':'Delete'}</button></td></tr>`).join(''); const rate = (yes+no)? percent(yes/(yes+no)) : '–'; return `<div class="card" style="margin-top:14px"><div class="kv"><div>${LANG==='tr'?'İsabet Oranı':'Hit Rate'}</div><div><b>${yes}</b>/<b>${yes+no}</b> <span class="muted">(${rate})</span></div></div><div style="overflow:auto; margin-top:8px"><table style="width:100%; border-collapse:collapse"><thead><tr><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('time')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('note')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('status')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('action')}</th></tr></thead><tbody>${rows}</tbody></table></div></div>` }

// ========== Remote Viewing ==========
const RV_POOL = [
  {k:'dağ', svg:`<svg width='96' height='64' viewBox='0 0 96 64' xmlns='http://www.w3.org/2000/svg'><rect width='96' height='64' rx='8' fill='#0d131c'/><path d='M8 52 32 20l10 14 10-14 28 32' fill='none' stroke='white' stroke-width='3'/></svg>`},
  {k:'fener', svg:`<svg width='96' height='64' xmlns='http://www.w3.org/2000/svg'><rect width='96' height='64' rx='8' fill='#0d131c'/><rect x='42' y='20' width='12' height='24' fill='white'/><polygon points='48,16 56,20 40,20' fill='white'/><polygon points='48,28 96,18 96,46' fill='#ffd166' opacity='0.6'/></svg>`},
  {k:'köprü', svg:`<svg width='96' height='64' xmlns='http://www.w3.org/2000/svg'><rect width='96' height='64' rx='8' fill='#0d131c'/><path d='M8 44h80' stroke='white' stroke-width='3'/><path d='M16 44c10-20 54-20 64 0' stroke='white' stroke-width='3' fill='none'/></svg>`},
  {k:'palmiye', svg:`<svg width='96' height='64' xmlns='http://www.w3.org/2000/svg'><rect width='96' height='64' rx='8' fill='#0d131c'/><path d='M48 50v-20' stroke='white' stroke-width='3'/><path d='M48 30c10-10 22-8 30 0M48 30c-10-10-22-8-30 0' stroke='white' stroke-width='3' fill='none'/></svg>`},
  {k:'göz', svg:`<svg width='96' height='64' xmlns='http://www.w3.org/2000/svg'><rect width='96' height='64' rx='8' fill='#0d131c'/><path d='M8 32c12-14 68-14 80 0-12 14-68 14-80 0' fill='none' stroke='white' stroke-width='3'/><circle cx='48' cy='32' r='8' fill='#7c3aed'/></svg>`},
  {k:'gemi', svg:`<svg width='96' height='64' xmlns='http://www.w3.org/2000/svg'><rect width='96' height='64' rx='8' fill='#0d131c'/><polygon points='20,38 76,38 70,46 26,46' fill='white'/><path d='M14 50h68' stroke='#06b6d4' stroke-width='3'/></svg>`}
];
function remote(){ let s = store.get('rv-state', null); if(!s){ const pool=[]; while(pool.length<4){ const x = spick(RV_POOL); if(!pool.includes(x)) pool.push(x) } s={ id:uid(), phase:'view', pool, target:Math.floor(srand()*4), notes:'', ts:Date.now() }; store.set('rv-state', s) } if(s.phase==='view'){ return `<div class="section-title">${t('remote')}</div><div class="sub">${LANG==='tr'?'Aşağıdaki 4 hedeften biri gizlice seçildi. 3–5 dk serbest betimleme yaz, sonra seçim yap.':'One of 4 targets is hidden. Describe freely for 3–5 min, then choose.'}</div><div class="card" style="margin-top:10px"><b>${LANG==='tr'?'Hedef Havuzu (4)':'Target Pool (4)'}</b><div class="rv-grid" style="margin-top:8px">${s.pool.map(x=>`<div class='rv-card'><div class='rv-thumb'>${x.svg}</div></div>`).join('')}</div></div><label class="muted" style="display:block; margin:10px 0 6px">${LANG==='tr'?'Betimleme / İpuçları':'Description / Cues'}</label><textarea oninput="(function(v){ const s=store.get('rv-state'); s.notes=v; store.set('rv-state',s) })(this.value)">${s.notes||''}</textarea><div class="row" style="margin-top:10px"><button class="btn" onclick="(function(){ const s=store.get('rv-state'); s.phase='choose'; store.set('rv-state',s); go('remote') })()">${t('choose')}</button><button class="btn secondary" onclick="rvReset(true)">${t('reset_session')}</button></div>` } if(s.phase==='choose'){ return `<div class="section-title">${t('choice')}</div><div class="sub">${LANG==='tr'?'Hangi hedefe en çok benziyor?':'Which target matches best?'}</div><div class="row" style="margin-top:10px">${s.pool.map((x,i)=>`<button class="btn secondary" onclick="rvChoose(${i})">${i+1}</button>`).join('')}</div><div class="foot">RNG seed: <span class="mono">${store.get('rng-seed')}</span></div>` } if(s.phase==='done'){ const ok = s.choice===s.target; const entry = `<div class="card" style="margin-top:10px"><div class="inline-stat"><span class="chip">${t('choice')}: <b>${s.choice+1}</b></span><span class="chip">${t('target')}: <b>${s.target+1}</b></span><span class="chip">${t('status')}: <b>${ok? (LANG==='tr'?'Doğru':'Correct'):(LANG==='tr'?'Yanlış':'Wrong')}</b></span></div><div class="row" style="margin-top:10px">${s.pool.map((x,i)=>`<div class='rv-thumb' title='${i+1}'>${x.svg}</div>`).join('')}</div><div style="margin-top:8px"><b>${LANG==='tr'?'Betimleme':'Description'}:</b><div class="muted">${(s.notes||'—').replace(/[<>]/g,'')}</div></div></div>`; return `<div class="section-title">${t('result')}</div>${entry}<div class="row" style="margin-top:12px"><button class="btn" onclick="rvSave()">${t('save')}</button><button class="btn secondary" onclick="rvReset()">${t('new_session')}</button></div>${renderRVHistory()}` } }
function rvChoose(i){ const s=store.get('rv-state'); s.choice=i; s.phase='done'; store.set('rv-state',s); go('remote') }
function rvSave(){ const s=store.get('rv-state'); if(!s||s.phase!=='done') return; const arr=store.get('rv-sessions', []); const entry={id:s.id, ts:s.ts, pool:s.pool.map(p=>p.k), target:s.target, choice:s.choice, notes:s.notes, correct: s.choice===s.target?1:0}; arr.push(entry); store.set('rv-sessions', arr); store.del('rv-state'); awardBadges(); alert(LANG==='tr'?'Kaydedildi.':'Saved.'); go('remote') }
function rvReset(confirmAsk){ if(confirmAsk && !confirm(t('confirm_reset'))) return; store.del('rv-state'); go('remote') }
function renderRVHistory(){ const arr = store.get('rv-sessions', []); if(arr.length===0) return `<div class="card" style="margin-top:16px"><div class="muted">${t('no_records')}</div></div>`; const rows = arr.slice().reverse().map(s=> `<tr><td class="mono">${fmtDate(s.ts)}</td><td>${s.correct? (LANG==='tr'?'Doğru':'Correct'):(LANG==='tr'?'Yanlış':'Wrong')}</td><td>${s.pool[s.target]}</td><td>${s.pool[s.choice]}</td><td class="muted">${(s.notes||'').slice(0,80)}${(s.notes||'').length>80?'…':''}</td></tr>`).join(''); const ok = arr.reduce((a,x)=>a+x.correct,0); const series = arr.map(s=> s.correct?100:0 ); return `<div class="card" style="margin-top:16px"><div class="section-title">${t('history')}</div><div style="margin:6px 0">${series.length? sparkbar(series.slice(-16)) : ''}</div><div class="kv"><div>${t('summary')}</div><div><b>${ok}/${arr.length}</b> <span class="muted">(${percent(ok/arr.length)})</span></div></div><div style="overflow:auto"><table style="width:100%; border-collapse:collapse; margin-top:8px"><thead><tr><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('date')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('result')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('target')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('choice')}</th><th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,.1)">${t('note')}</th></tr></thead><tbody>${rows}</tbody></table></div></div>` }

// ========== About ==========
function about(){
  return `
  <div class="section-title">${LANG==='tr'?'Hakkında / Rehber':'About / Guide'}</div>

  <div class="row tabs" style="gap:8px;margin:6px 0 12px">
    <button class="btn secondary" onclick="aboutTab('intro')">${LANG==='tr'?'Intro & Gizlilik':'Intro & Privacy'}</button>
    <button class="btn secondary" onclick="aboutTab('zener')">Zener</button>
    <button class="btn secondary" onclick="aboutTab('ganz')">Mini-Ganzfeld</button>
    <button class="btn secondary" onclick="aboutTab('ruya')">${LANG==='tr'?'Rüya Testi':'Dream Test'}</button>
    <button class="btn secondary" onclick="aboutTab('rv')">Remote Viewing</button>
    <button class="btn secondary" onclick="aboutTab('onsezi')">${LANG==='tr'?'Önsezi Günlüğü':'Premonition Log'}</button>
    <button class="btn secondary" onclick="aboutTab('seed')">RNG Seed</button>
  </div>

  <!-- Intro -->
  <div id="about-intro" class="about-tab">
    <p><b>Tabirly • ESP Self-Test</b> ${LANG==='tr'
      ? 'tamamen eğlence ve merak içindir; sonuçlar bilimsel/medikal/finansal kararların yerine geçmez.'
      : 'is purely for fun and curiosity; results are not a substitute for scientific/medical/financial decisions.'}</p>
    <p><b>${LANG==='tr'?'Veri Gizliliği':'Privacy'}:</b>
      ${LANG==='tr'
        ? 'Tüm veriler tarayıcındadır (localStorage). Sunucuya yüklenmez. JSON/CSV dışa aktarabilir, tek tıkla silebilirsin.'
        : 'All data stays in your browser (localStorage). Nothing is uploaded. You can export JSON/CSV or wipe everything with one click.'}
    </p>
    <p class="muted">${LANG==='tr'
      ? 'Bu testler “paranormal yetenek ölçümü” değildir; sezgi/yanlılık ve deneyim odaklıdır.'
      : 'These are not “paranormal ability measurements”; they focus on intuition/bias and experience.'}</p>
  </div>

  <!-- Zener -->
  <div id="about-zener" class="about-tab" style="display:none">
    <h3>🃏 Zener</h3>

    <p>
      ${LANG==='tr'
        ? '5 sembol (⭐ ⚫ ➕ ◼ 🌊) ile 25 tur tahmin yaparsın. Her turda içinden gelen ilk tahmini seç; geri dönme veya yaz-boz yoktur. 25 tur bittiğinde “Seansı Kaydet”e bas; tek seferlik sonuç yerine seri halinde birkaç oturum yap. Şans düzeyi p=0.2 kabul edilirse, beklenen doğru sayısı yaklaşık 5’tir.'
        : 'You make 25 trials with 5 symbols (⭐ ⚫ ➕ ◼ 🌊). In each trial, choose the first impression; do not backtrack or revise. When 25 trials are over, press “Save Session”; prefer a series of multiple sessions rather than a single one. With chance level p=0.2, the expected number of correct responses is about 5.'}
    </p>

    <p>
      <b>${LANG==='tr' ? 'Amaç' : 'Goal'}:</b>
      ${LANG==='tr'
        ? '“Sezgisel eşleşme” gibi anlık seçim davranışında hedef dışı örüntüler (yanlılık / hafif avantaj) olup olmadığını şans modeline göre test etmek; sonuç binom dağılımının kuyruk olasılığıyla gösterilir.'
        : 'To test, against a chance model, whether instantaneous choice behavior shows off-target patterns (bias / slight advantage); summarized via the tail probability of the binomial distribution.'}
    </p>

    <p><b>${LANG==='tr' ? 'Ne Ölçer?' : 'What Does It Measure?'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'İsabet oranı = doğru / deneme.' : 'Hit rate = correct / trials.'}</li>
      <li>${LANG==='tr'
          ? 'Binom kuyruk olasılığı <code>P(X ≥ k; n, p = 0.2)</code> — belirli bir isabet sayısına yalnızca şansla ulaşma olasılığı.'
          : 'Binomial tail probability <code>P(X ≥ k; n, p = 0.2)</code> — probability of hitting at least k by chance alone.'}
      </li>
    </ul>

    <p><b>${LANG==='tr' ? 'Sonuçları Nasıl Yorumlarım?' : 'How Do I Interpret the Results?'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'p-değeri yüksekse (≥%10) normal dalgalanma; şansla uyumlu.' : 'High p-value (≥10%) ⇒ normal fluctuation; compatible with chance.'}</li>
      <li>${LANG==='tr' ? 'p-değeri çok düşükse (&lt;%1) seri içinde şaşırtıcı olabilir; yeni oturumlarla teyit et.' : 'Very low p (&lt;1%) may be surprising; try to confirm with more sessions.'}</li>
      <li>${LANG==='tr' ? 'Tek oturumla hüküm verme; 5–10 oturumluk seri daha değerlidir.' : 'Don’t judge from a single session; use 5–10 session series.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'Sık Yapılan Hatalar' : 'Common Mistakes'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Geri dönüp tahmini düzeltmek veriyi bozar.' : 'Backtracking to “fix” a guess corrupts data.'}</li>
      <li>${LANG==='tr' ? '“Hissedene kadar beklemek” karar süresini uzatır; ilk izlenimle seç.' : '“Waiting until it feels right” prolongs decisions; pick the first impression.'}</li>
      <li>${LANG==='tr' ? 'Sembol frekansını tahmin etmeye çalışmak yanlılık üretir.' : 'Trying to outsmart symbol frequency introduces bias.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'İpuçları' : 'Tips'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Kısa ve sabit bir ön-rutin uygula (30–60 sn nefes sayma).' : 'Use a brief, consistent pre-session routine (30–60s breath counting).'}</li>
      <li>${LANG==='tr' ? 'Seed sabitse günler arası kıyas kolaylaşır.' : 'A fixed seed makes across-day comparison easier.'}</li>
      <li>${LANG==='tr' ? 'Aynı gün peş peşe çok oturum yapma.' : 'Avoid too many back-to-back sessions.'}</li>
    </ul>
  </div>

  <!-- Mini-Ganzfeld -->
  <div id="about-ganz" class="about-tab" style="display:none">
    <h3>🔮 Mini-Ganzfeld</h3>
    <p>
      ${LANG==='tr'
        ? 'Sistem dört gizli hedef kavram üretir (ör. “Kırmızı kapı, Gitar, Karlı dağ, Şimşek”). Aşama 1 — İzlenim: 2–5 dakika serbest çağrışım notları yaz. Aşama 2 — Seçim: Yazdıklarınla en çok uyuşan hedefi seç ve kaydet.'
        : 'The system generates four hidden targets. Stage 1 — Impressions: free-association notes for 2–5 minutes. Stage 2 — Choice: pick the target that best matches your notes and save.'}
    </p>
    <ul>
      <li>${LANG==='tr' ? 'Önce not → sonra seçim (bias azalır).' : 'Notes first → choice later (reduces bias).'}</li>
      <li>${LANG==='tr' ? 'Şans düzeyi 1/4 (p=0.25).' : 'Chance level 1/4 (p=0.25).'}</li>
      <li>${LANG==='tr' ? '20–30 oturumluk seri tercih edin.' : 'Prefer 20–30 session series.'}</li>
    </ul>
    <p><b>${LANG==='tr' ? 'Amaç' : 'Goal'}:</b>
      ${LANG==='tr'
        ? 'Dış uyaranı azaltıp zihinsel içerik ↔ gizli hedef benzerliğini araştırmak.'
        : 'Minimize external stimuli to examine similarity between mental content and the hidden target.'}
    </p>
    <p><b>${LANG==='tr' ? 'Ne Ölçer?' : 'What Does It Measure?'}:</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Oturum bazında doğru/yanlış.' : 'Per-session hit/miss.'}</li>
      <li>${LANG==='tr' ? 'Seri isabet oranı + mini trend grafiği.' : 'Series hit rate + mini trend chart.'}</li>
    </ul>
    <p><b>${LANG==='tr' ? 'Yorum' : 'Interpretation'}:</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Tek oturumluk sonuç kanıt değildir.' : 'Single-session result isn’t evidence.'}</li>
      <li>${LANG==='tr' ? 'Uzun seride kalıcı yüksek oran dikkat çekicidir.' : 'Persistent above-chance rate across long series is notable.'}</li>
      <li>${LANG==='tr' ? 'Ana motif mi yoksa zorlama benzetme mi?' : 'Main motifs vs forced analogies?'}</li>
    </ul>
    <p><b>${LANG==='tr' ? 'Hatalar' : 'Mistakes'}:</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Notu çok kısa tutmak.' : 'Notes too brief.'}</li>
      <li>${LANG==='tr' ? 'Havuzu görüp ona göre yazmak (ankor).' : 'Seeing pool then shaping notes (anchoring).'}</li>
      <li>${LANG==='tr' ? 'Aşırı spesifik isim/nesneye kilitlenmek.' : 'Locking onto an overly specific object/name.'}</li>
    </ul>
    <p><b>${LANG==='tr' ? 'İpuçları' : 'Tips'}:</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Duyusal etiketlerle yaz (renk/doku/hareket).' : 'Use sensory labels (color/texture/motion).'}</li>
      <li>${LANG==='tr' ? 'Negatif eleme yap (erken iki aday dışarı).' : 'Use negative elimination (drop two early).'}</li>
      <li>${LANG==='tr' ? 'Günde 1–2 oturum idealdir.' : '1–2 sessions/day ideal.'}</li>
    </ul>
  </div>

  <!-- Dream -->
  <div id="about-ruya" class="about-tab" style="display:none">
    <h3>🌙 ${LANG==='tr'?'Rüya Testi':'Dream Test'}</h3>
    <p>${LANG==='tr'
      ? 'Yatmadan önce bir tema belirle; sabah uyanır uyanmaz ≤30 sn rüyayı yaz; akşam “Eşleşti / Eşleşmedi” olarak işaretle.'
      : 'Set a theme before sleep; upon waking write your dream within ≤30s; in the evening mark “Matched / Not”.'}</p>
    <p class="muted">${LANG==='tr'
      ? 'Gerçek hayat sonuçları değil; gece seçilen hedef/tema ↔ sabah rüya notunun benzerliği ölçülür.'
      : 'Not real-life outcomes; measures similarity between selected theme and morning note.'}</p>

    <p><b>${LANG==='tr' ? 'Pratik Akış' : 'Practical Flow'}</b></p>
    <ol>
      <li><b>${LANG==='tr' ? 'Gece — hedef belirle:' : 'Night — set target:'}</b>
        <ul>
          <li>${LANG==='tr' ? '“Hedef/Tema”ya tek cümle yaz (ör. kırmızı kapı, deniz kıyısı).' : 'Write a one-sentence target/theme.'}</li>
          <li>${LANG==='tr' ? 'Kaydet.' : 'Save.'}</li>
        </ul>
      </li>
      <li><b>${LANG==='tr' ? 'Sabah — rüya notu:' : 'Morning — dream note:'}</b>
        <ul>
          <li>${LANG==='tr' ? '2–3 kısa cümle: renkler, nesneler, duygular, mekân ipuçları.' : '2–3 short sentences: colors, objects, emotions, location cues.'}</li>
          <li>${LANG==='tr' ? 'Örn: “Koyu kırmızı yüzey, dar geçit hissi, metalik ses.”' : 'e.g., “Dark red surface, narrow passage, metallic sound.”'}</li>
        </ul>
      </li>
      <li><b>${LANG==='tr' ? 'Akşam — değerlendirme:' : 'Evening — evaluation:'}</b>
        <ul>
          <li>${LANG==='tr' ? 'Gerçekten benzeşiyor mu?' : 'Does it genuinely match?'}</li>
          <li>${LANG==='tr' ? 'Eşleşti / Eşleşmedi; kararsızsan boş bırak.' : 'Mark Matched / Not; leave blank if unsure.'}</li>
        </ul>
      </li>
    </ol>

    <p><b>${LANG==='tr' ? 'Eşleşme Kriteri' : 'Match Criteria'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Ana motif yakalandıysa “Eşleşti”.' : 'Main motif captured ⇒ “Matched”.'}</li>
      <li>${LANG==='tr' ? 'İkincil/zorlamaysa “Eşleşmedi”.' : 'Secondary/forced ⇒ “Not”.'}</li>
      <li>${LANG==='tr' ? 'Kriteri sabit tut.' : 'Keep criterion consistent.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'İpuçları' : 'Tips'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Gecelik tek hedef seç.' : 'One target per night.'}</li>
      <li>${LANG==='tr' ? 'Cümle yoksa 3–5 anahtar kelime yaz.' : 'If no sentences, write 3–5 keywords.'}</li>
      <li>${LANG==='tr' ? 'Kararsızsan boş bırak; istatistiği bozma.' : 'If uncertain, leave blank.'}</li>
      <li>${LANG==='tr' ? 'Oran yerine serideki trende bak.' : 'Look at the trend across the series.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'Sık Durumlar' : 'Common Situations'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Sabah notu kaçırırsan gün içinde yazma; o günü boş bırak.' : 'If you miss the morning note, don’t write it later; leave blank.'}</li>
      <li>${LANG==='tr' ? 'Hedef çok genişse ölçmesi zor; ölçülebilir temalar kullan.' : 'Over-broad targets are hard to measure; pick measurable themes.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'Uygulamada Yapacağın Tıklamalar' : 'Clicks in the App'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Gece: Rüya Testi → Hedef/Tema → Kaydet' : 'Night: Dream Test → Target/Theme → Save'}</li>
      <li>${LANG==='tr' ? 'Sabah: listeden bugünün satırı → Rüya Notu → Kaydet' : 'Morning: today’s row → Dream Note → Save'}</li>
      <li>${LANG==='tr' ? 'Akşam: ilgili satır → Eşleşti / Eşleşmedi' : 'Evening: the row → Matched / Not'}</li>
    </ul>
  </div>

  <!-- Remote Viewing -->
  <div id="about-rv" class="about-tab" style="display:none">
    <h3>👁 Remote Viewing</h3>
    <p>${LANG==='tr'
      ? 'Sistem dört görsel/tema seçer. Aşama 1 — Betimleme: görsele bakmadan 2–3 dk duyusal betimleme yaz. Aşama 2 — Seçim: en çok uyuşanı seç ve kaydet.'
      : 'System selects four visuals/themes. Stage 1 — Description: write sensory notes for 2–3 min without viewing. Stage 2 — Choice: pick best match and save.'}</p>
    <ul>
      <li>${LANG==='tr' ? 'Sıra: önce notlar → sonra seçim.' : 'Order: notes first → choice later.'}</li>
      <li>${LANG==='tr' ? 'Şans düzeyi 1/4 (p=0.25).' : 'Chance level 1/4 (p=0.25).'}</li>
      <li>${LANG==='tr' ? 'Ana motiflere odaklan.' : 'Focus on main motifs.'}</li>
    </ul>
    <p><b>${LANG==='tr' ? 'Amaç' : 'Goal'}:</b>
      ${LANG==='tr'
        ? 'Uzak/gizli hedefi zihinsel imgelerle yakalama iddiasını oyunlaştırmak.'
        : 'Gamify detecting a distant/hidden target via mental imagery.'}
    </p>
    <p><b>${LANG==='tr' ? 'Ne Ölçer?' : 'What Does It Measure?'}:</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Oturum bazında doğru/yanlış.' : 'Per-session hit/miss.'}</li>
      <li>${LANG==='tr' ? 'Seri isabet oranı (beklenti ≈%25).' : 'Series hit rate (expect ≈25%).'}</li>
    </ul>
    <p><b>${LANG==='tr' ? 'Hatalar' : 'Mistakes'}:</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Önce görsellere bakmak → ankor/rasyonalizasyon.' : 'Viewing images first → anchoring/rationalization.'}</li>
      <li>${LANG==='tr' ? 'Aşırı spesifik tek tahmine kilitlenmek.' : 'Locking to a single ultra-specific guess.'}</li>
      <li>${LANG==='tr' ? 'Notu çok kısa tutmak.' : 'Keeping notes too brief.'}</li>
    </ul>
    <p><b>${LANG==='tr' ? 'İpuçları' : 'Tips'}:</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Duyusal kategorilerle yaz.' : 'Use sensory categories.'}</li>
      <li>${LANG==='tr' ? 'Önce negatif eleme yap.' : 'Do negative elimination first.'}</li>
      <li>${LANG==='tr' ? 'Notu yüksek sesle okumak zihni netleştirir.' : 'Reading notes aloud can clarify motifs.'}</li>
    </ul>
  </div>

  <!-- Premonition -->
  <div id="about-onsezi" class="about-tab" style="display:none">
    <h3>⚡ ${LANG==='tr'?'Önsezi Günlüğü':'Premonition Log'}</h3>
    <p>${LANG==='tr'
      ? 'Ani his geldiğinde kısa not bırak; akşam/ertesi gün “Oldu / Olmadı” işaretle.'
      : 'When a hunch arises, jot a brief note; mark “Happened / Didn’t” later.'}</p>

    <p><b>${LANG==='tr' ? 'Nasıl Kullanılır?' : 'How To Use'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Bir cümlelik not (ör. “Bugün X arayacak”).' : 'One-sentence notes (e.g., “X will call today”).'}</li>
      <li>${LANG==='tr' ? 'Akşam/ertesi gün sonucu işaretle.' : 'Mark the outcome that evening/next day.'}</li>
      <li>${LANG==='tr' ? 'Tarih + bağlam ekle.' : 'Add date + context.'}</li>
      <li>${LANG==='tr' ? 'Opsiyonel: kategori etiketi, güven puanı.' : 'Optional: category tag, confidence.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'Amaç' : 'Goal'}</b></p>
    <p>${LANG==='tr'
      ? 'Sezgileri sistematik kayda almak; “doğru olanlar akılda kalır” yanlılığını dengelemek.'
      : 'Systematically record intuitions and counter the “only hits stick” bias.'}</p>

    <p><b>${LANG==='tr' ? 'Ne Ölçer?' : 'Measures'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Toplam not ve Oldu/Olmadı oranı.' : 'Total notes and Happened/Didn’t ratio.'}</li>
      <li>${LANG==='tr' ? 'Kategori bazlı zaman içi görünüm.' : 'Category-level view over time.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'Hatalar' : 'Mistakes'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Sadece “doğruları” kaydetmek.' : 'Recording only hits.'}</li>
      <li>${LANG==='tr' ? 'Aşırı genel notlar (“bir şey olacak”).' : 'Overly vague notes (“something will happen”).'}</li>
      <li>${LANG==='tr' ? 'Günün sonunda topluca yazmak (hatırlama yanlılığı).' : 'Writing later at day’s end (recall bias).'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'İpuçları' : 'Tips'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Her notu tarih+bağlamla yaz.' : 'Write each note with date+context.'}</li>
      <li>${LANG==='tr' ? 'Haftalık/aylık tabloları incele.' : 'Review weekly/monthly patterns.'}</li>
      <li>${LANG==='tr' ? 'Notu anında gir; “sonradan uydurma” hissini önler.' : 'Enter immediately; avoids “retro-fit”.'}</li>
    </ul>
  </div>

  <!-- RNG Seed -->
  <div id="about-seed" class="about-tab" style="display:none">
    <h3>🎲 RNG Seed</h3>
    <p>${LANG==='tr'
      ? '<b>Nedir:</b> Rastgele üretecin başlangıç noktası. Aynı seed → aynı dizilim.'
      : '<b>What:</b> Start point of the RNG. Same seed → same sequence.'}</p>
    <ul>
      <li>${LANG==='tr' ? 'Büyüklük zorluğu değiştirmez; sadece dizilimi değiştirir.' : 'Magnitude doesn’t change difficulty; only the sequence.'}</li>
      <li>${LANG==='tr' ? 'Karşılaştırma için seed sabitle.' : 'Fix seed for comparisons.'}</li>
      <li>${LANG==='tr' ? 'Her sefer farklı istersen rastgeleleştir.' : 'Randomize for fresh runs.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'RNG Seed Nedir?' : 'What Is an RNG Seed?'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'RNG = rastgele sayı üretecinin başlangıcı.' : 'RNG seed = generator’s starting point.'}</li>
      <li>${LANG==='tr' ? 'Bilgisayarda rastgelelik deterministiktir.' : 'Computer randomness is deterministic.'}</li>
      <li>${LANG==='tr' ? 'Aynı seed → aynı sıra; farklı seed → farklı sıra.' : 'Same seed → same order; different seed → different order.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'Amacı' : 'Why Use It'}</b></p>
    <ul>
      <li><b>${LANG==='tr' ? 'Şeffaflık' : 'Transparency'}</b></li>
      <li><b>${LANG==='tr' ? 'Tekrar edilebilirlik' : 'Repeatability'}</b></li>
      <li><b>${LANG==='tr' ? 'Deneysel güven' : 'Experimental confidence'}</b></li>
    </ul>

    <p><b>${LANG==='tr' ? 'Nasıl Ayarlanır?' : 'How To Set'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Ayarlar → RNG Seed kısmına sayı gir.' : 'Settings → RNG Seed: enter a number.'}</li>
      <li>${LANG==='tr' ? '“Rastgeleleştir” yeni seed üretir.' : '“Randomize” generates a new seed.'}</li>
      <li>${LANG==='tr' ? 'Tüm testler aynı seed ile çalışır.' : 'All tests run using the same seed.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'Artırınca/Azaltınca' : 'Increase/Decrease'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Seed sadece başlangıçtır; zorluk değiştirmez.' : 'Seed is just a start; doesn’t change difficulty.'}</li>
      <li>${LANG==='tr' ? 'Seed=1 ve Seed=9999 aynı derecede rastgele.' : 'Seed=1 and Seed=9999 are equally random.'}</li>
      <li>${LANG==='tr' ? '“Yüksek seed zor” diye bir şey yok.' : 'No such thing as “higher seed is harder”.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'Kullanım Senaryoları' : 'Use Cases'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Kendi kendine tekrar: Seed=1234 ile bugün/gelecek hafta aynı sıralama.' : 'Self-replication: Seed=1234 today/next week → same order.'}</li>
      <li>${LANG==='tr' ? 'Arkadaşla karşılaştırma: ikiniz de aynı seed.' : 'Peer comparison: both use same seed.'}</li>
      <li>${LANG==='tr' ? 'Rapor PNG’de seed görünür → yeniden üretilebilir.' : 'Report PNG shows the seed → reproducible.'}</li>
    </ul>

    <p><b>${LANG==='tr' ? 'İpuçları' : 'Tips'}</b></p>
    <ul>
      <li>${LANG==='tr' ? 'Karşılaştırma için seed sabitle.' : 'Fix seed for comparisons.'}</li>
      <li>${LANG==='tr' ? '“Her sefer farklı” istersen rastgeleleştir.' : 'Randomize for variety.'}</li>
      <li>${LANG==='tr' ? 'Tek bir seed ile aşırı tekrar yapma; farklı seed’ler dene.' : 'Don’t over-repeat one seed; vary seeds.'}</li>
    </ul>
  </div>
  `;
}

function aboutTab(id){
  document.querySelectorAll('.about-tab').forEach(el=>el.style.display='none');
  const target=document.getElementById('about-'+id); if(target) target.style.display='block';
}

// ========== Settings ==========
function settings(){ const seed = store.get('rng-seed'); const theme = store.get('theme'); const prof = getProfile(); return `<div class="section-title">${t('settings')}</div><div class="card" style="margin-top:8px"><div class="section-title">${t('rng_seed')}</div><p class="muted">${t('rng_note')}</p><div class="settings-grid"><div><label>${t('rng_seed')}</label><input id="seedInput" type="number" value="${seed}" /></div><div class="flex-center" style="margin-top:22px"><button class="btn secondary" onclick="document.getElementById('seedInput').value = (Date.now() & 0xffffffff)>>>0">${t('randomize')}</button><button class="btn" onclick="setSeed(document.getElementById('seedInput').value); go('settings')">${t('set_seed')}</button></div></div></div><div class="card" style="margin-top:12px"><div class="section-title">${t('theme')}</div><div class="settings-grid"><div><label>${t('brand_primary')}</label><input id="c1" type="color" value="${(theme&&theme.c1)||'#7c3aed'}" /></div><div><label>${t('brand_secondary')}</label><input id="c2" type="color" value="${(theme&&theme.c2)||'#06b6d4'}" /></div></div><div class="row" style="margin-top:10px"><button class="btn" onclick="applyTheme()">${t('save')}</button></div></div><div class="card" style="margin-top:12px"><div class="section-title">${t('profile')}</div><div class="settings-grid"><div><label>${t('name')}</label><input id="pname" type="text" value="${prof.name}" /></div></div><div class="row" style="margin-top:10px"><button class="btn" onclick="(function(){ const p=getProfile(); p.name = document.getElementById('pname').value; setProfile(p); alert(t('profile_updated')); go('settings') })()">${t('save')}</button></div></div>` }
function applyTheme(){ const c1=document.getElementById('c1').value, c2=document.getElementById('c2').value; document.documentElement.style.setProperty('--brand', c1); document.documentElement.style.setProperty('--brand2', c2); store.set('theme', {c1,c2}); alert(t('theme_updated')); }
(function restoreTheme(){ const th=store.get('theme'); if(th){ document.documentElement.style.setProperty('--brand', th.c1); document.documentElement.style.setProperty('--brand2', th.c2) } })();

// ========== Export / Import / Share Image ==========
function exportJSON(){ const data = {}; ['zener-sessions','ganzfeld-sessions','dream-entries','premonitions','rng-seed','theme','profile','rv-sessions'].forEach(k=> data[k]=store.get(k, []) ); download('tabirly-esp-data.json', JSON.stringify({version:3, exportedAt:Date.now(), lang:LANG, data}, null, 2)); }
function exportCSV(){ function toCSV(rows){ return rows.map(r=> r.map(x=> '"'+String(x).replace(/"/g,'""')+'"').join(',')).join('\n') } const z = store.get('zener-sessions', []).map(s=> [new Date(s.ts).toISOString(), s.hits, s.n, (s.hits/s.n).toFixed(3)]); const g = store.get('ganzfeld-sessions', []).map(s=> [new Date(s.ts).toISOString(), s.pool[s.target], s.pool[s.choice], s.correct]); const d = store.get('dream-entries', []).map(x=> [x.date, x.goal, (x.note||'').replace(/\n/g,' '), x.matched]); const p = store.get('premonitions', []).map(x=> [new Date(x.ts).toISOString(), x.note, x.confirmed]); const rv = store.get('rv-sessions', []).map(s=> [new Date(s.ts).toISOString(), s.pool[s.target], s.pool[s.choice], s.correct]); const parts = [ ['# Zener: ts,hits,n,ratio'], ...z, [''], ['# Ganzfeld: ts,target,choice,correct(1/0)'], ...g, [''], ['# Remote: ts,target,choice,correct(1/0)'], ...rv, [''], ['# Dreams: date,goal,note,matched(true/false/null)'], ...d, [''], ['# Premonitions: ts,note,confirmed(true/false/null)'], ...p ]; download('tabirly-esp-data.csv', toCSV(parts)); }
function importJSON(ev){ const file = ev.target.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = () => { try{ const obj = JSON.parse(reader.result); if(!obj || !obj.data) throw new Error('Geçersiz JSON'); const d = obj.data; ['zener-sessions','ganzfeld-sessions','dream-entries','premonitions','rng-seed','theme','profile','rv-sessions'].forEach(k=>{ if(d[k]!==undefined){ store.set(k, d[k]); if(k==='rng-seed') setSeed(d[k]) } }); const th = d['theme']; if(th){ document.documentElement.style.setProperty('--brand', th.c1); document.documentElement.style.setProperty('--brand2', th.c2) } alert(LANG==='tr'?'Veriler yüklendi.':'Data loaded.'); location.reload(); }catch(e){ alert('Load error: '+e.message) } }; reader.readAsText(file); }
function shareImage(){ const z = store.get('zener-sessions', []); const g = store.get('ganzfeld-sessions', []); const rv = store.get('rv-sessions', []); const d = store.get('dream-entries', []); const p = store.get('premonitions', []); const zHits = z.reduce((a,s)=>a+s.hits,0), zN = z.reduce((a,s)=>a+s.n,0); const gHits = g.reduce((a,s)=>a+s.correct,0), gN = g.reduce((a,s)=>a+s.n,0); const rvHits = rv.reduce((a,s)=>a+s.correct,0); const dMatch = d.filter(x=>x.matched===true).length; const pHit = p.filter(x=>x.confirmed===true).length; const name = (getProfile().name||'Tabirly User'); const seed = store.get('rng-seed'); const w=1000,h=560; const c=document.createElement('canvas'); c.width=w; c.height=h; const ctx=c.getContext('2d'); const ggrad=ctx.createLinearGradient(0,0,w,h); ggrad.addColorStop(0,'#0b0e13'); ggrad.addColorStop(1,'#0a0d12'); ctx.fillStyle=ggrad; ctx.fillRect(0,0,w,h); ctx.fillStyle='#06b6d4'; ctx.font='700 28px Inter, system-ui, sans-serif'; ctx.fillText('Tabirly • ESP Report', 24, 44); ctx.fillStyle='#8aa0b3'; ctx.font='16px Inter, system-ui, sans-serif'; ctx.fillText(new Date().toLocaleString(), 24, 68); ctx.fillStyle='#e6eef5'; ctx.font='20px Inter, system-ui, sans-serif'; ctx.fillText(''+name, 24, 108); ctx.fillStyle='#8aa0b3'; ctx.font='14px Inter, system-ui, sans-serif'; ctx.fillText('Seed: '+seed, 24, 132); function card(x,y,wc,hc,title,lines){ ctx.fillStyle='rgba(255,255,255,0.04)'; ctx.strokeStyle='rgba(255,255,255,0.12)'; ctx.lineWidth=1; roundRect(ctx,x,y,wc,hc,16,true,true); ctx.fillStyle='#e6eef5'; ctx.font='700 18px Inter, system-ui, sans-serif'; ctx.fillText(title,x+16,y+28); ctx.fillStyle='#8aa0b3'; ctx.font='16px Inter, system-ui, sans-serif'; lines.forEach((ln,i)=> ctx.fillText(ln,x+16,y+60+i*22) ) } function roundRect(ctx,x,y,w,h,r,fill,stroke){ if (typeof r === 'number') { r = {tl:r, tr:r, br:r, bl:r}; } ctx.beginPath(); ctx.moveTo(x+r.tl, y); ctx.lineTo(x+w-r.tr, y); ctx.quadraticCurveTo(x+w, y, x+w, y+r.tr); ctx.lineTo(x+w, y+h-r.br); ctx.quadraticCurveTo(x+w, y+h, x+w-r.br, y+h); ctx.lineTo(x+r.bl, y+h); ctx.quadraticCurveTo(x, y+h, x, y+h-r.bl); ctx.lineTo(x, y+r.tl); ctx.quadraticCurveTo(x, y, x, y); ctx.closePath(); if(fill) ctx.fill(); if(stroke) ctx.stroke(); } card(24,160,300,140,'Zener', [ `Toplam: ${zHits}/${zN}`, `Oran: ${zN? (zHits/zN*100).toFixed(1)+'%':'—'}` ]); card(348,160,300,140,'Ganzfeld', [ `Toplam: ${gHits}/${gN}`, `Oran: ${gN? (gHits/gN*100).toFixed(1)+'%':'—'}` ]); card(672,160,300,140,'Remote', [ `Toplam: ${rvHits}/${rv.length}`, `—` ]); card(24,320,300,140,'Rüya', [ `Eşleşme: ${dMatch}/${d.length}` ]); card(348,320,300,140,'Önsezi', [ `İsabet: ${pHit}/${p.length}` ]); ctx.fillStyle='#8aa0b3'; ctx.font='12px Inter, system-ui, sans-serif'; ctx.fillText('Eğlence amaçlıdır. © Tabirly', 24, h-20); const url = c.toDataURL('image/png'); const a=document.createElement('a'); a.href=url; a.download='tabirly-esp-report.png'; a.click(); }

// ======= Global Expose for inline onclicks =======
Object.assign(window, {
  toggleLang, go, aboutTab,
  exportJSON, exportCSV, importJSON, shareImage,
  applyTheme, setSeed,
  zenerGuess, zenerFinish, zenerReset,
  ganzChoose, ganzSave, ganzReset,
  dreamAdd, dreamClearForm, dreamMatch, dreamDel,
  premAdd, premSet, premDel,
  rvChoose, rvSave, rvReset
});

// ======= Boot with error guard =======
window.addEventListener('error', e=>{
  const d=document.createElement('div');
  d.style.cssText='position:fixed;left:12px;bottom:12px;z-index:999999;background:rgba(255,0,0,.12);border:1px solid rgba(255,0,0,.4);padding:10px 12px;border-radius:10px;color:#ffdada;font:12px sans-serif;max-width:92vw';
  d.textContent='JS Hatası: '+e.message;
  document.body.appendChild(d);
});
try{ renderNav(); applyI18nStatic(); go('dashboard'); }catch(e){ console.error('Boot error', e); }

// Service worker
if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js').catch(console.error); }
</script>
</body>
</html>
